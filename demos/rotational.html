<!DOCTYPE html>
<html>
  <head>
    <title>cannon.js - callbacks demo</title>
    <meta charset="utf-8">
    <style>
        * {
            margin:0;
            padding:0;
        }
        body {
            overflow: hidden;
        }
    </style>
  </head>
  <body>
    <script src="../build/cannon.js"></script>
    <script src="../build/cannon.demo.js"></script>
    <script src="../libs/dat.gui.js"></script>
    <script src="../libs/Three.js"></script>
    <script src="../libs/Detector.js"></script>
    <script src="../libs/Stats.js"></script>
    <script src="../libs/smoothie.js"></script>
    <script>

        var demo = new CANNON.Demo();
        var mass = 1;

        demo.addScene("car",function(){
            var world = demo.getWorld();
            world.gravity.z = -5;
            world.gravity.x = 1;

            var wheelShape =      new CANNON.Sphere(1.2);
            var leftFrontWheel =  new CANNON.RigidBody(mass,wheelShape);
            var rightFrontWheel = new CANNON.RigidBody(mass,wheelShape);
            var leftRearWheel =   new CANNON.RigidBody(mass,wheelShape);
            var rightRearWheel =  new CANNON.RigidBody(mass,wheelShape);

            var chassisShape = new CANNON.Box(new CANNON.Vec3(5,2,0.5));
            var chassis = new CANNON.RigidBody(mass,chassisShape);

            // Position constrain wheels
            var zero = new CANNON.Vec3();
            leftFrontWheel .position.set(  5,  5, 0); world.addConstraint(new CANNON.PointToPointConstraint(chassis, new CANNON.Vec3( 5, 5,0), leftFrontWheel,  zero));
            rightFrontWheel.position.set(  5, -5, 0); world.addConstraint(new CANNON.PointToPointConstraint(chassis, new CANNON.Vec3( 5,-5,0), rightFrontWheel, zero));
            leftRearWheel  .position.set( -5,  5, 0); world.addConstraint(new CANNON.PointToPointConstraint(chassis, new CANNON.Vec3(-5, 5,0), leftRearWheel,   zero));
            rightRearWheel .position.set( -5, -5, 0); world.addConstraint(new CANNON.PointToPointConstraint(chassis, new CANNON.Vec3(-5,-5,0), rightRearWheel,  zero));

            // Constrain wheels
            var up = new CANNON.Vec3(0,1,0);
            var constraints = [];
            constraints.push( new CANNON.RotationalConstraint(chassis,up,leftFrontWheel, new CANNON.Vec3(0,0,1)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,rightFrontWheel,new CANNON.Vec3(0,0,1)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,leftRearWheel,  new CANNON.Vec3(0,0,1)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,rightRearWheel, new CANNON.Vec3(0,0,1)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,leftFrontWheel, new CANNON.Vec3(1,0,0)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,rightFrontWheel,new CANNON.Vec3(1,0,0)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,leftRearWheel,  new CANNON.Vec3(1,0,0)) );
            constraints.push( new CANNON.RotationalConstraint(chassis,up,rightRearWheel, new CANNON.Vec3(1,0,0)) );
            for(var i=0; i<constraints.length; i++)
                world.addConstraint(constraints[i]);

            var bodies = [chassis,leftFrontWheel,rightFrontWheel,leftRearWheel,rightRearWheel];
            for(var i=0; i<bodies.length; i++){
                world.add(bodies[i]);
                demo.addVisual(bodies[i]);
            }

            // Ground 
            var groundShape = new CANNON.Plane();
            var ground = new CANNON.RigidBody(0,groundShape);
            ground.position.z = -3;
            world.add(ground);
            demo.addVisual(ground);

        });


        demo.start();
      
    </script>
  </body>
</html>
