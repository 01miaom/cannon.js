<!DOCTYPE html>
<html>
  <head>
    <title>three.js / cannon.js example</title>
    <meta charset="utf-8">
    <style>* {margin:0;padding:0}</style>
  </head>
  <body>
    <script src="../libs/gl-matrix.js"></script>
    <script src="../libs/Three.js"></script>
    <script src="../build/cannon.js"></script>
    <script>

      var world, mass, body, shape, timeStep=1/60,
         camera, scene, renderer, geometry, material, mesh;
      
      initThree();
      initCannon();
      animate();
  
      function initCannon() {
          
          world = new CANNON.World();
          vec3.set(world.gravity,0,0,0);
          world.broadphase = new CANNON.NaiveBroadphase();
          world.solver.iterations = 10;
          
          shape = new CANNON.Box(vec3.fromValues(1,1,1));
          mass = 1;
          body = new CANNON.RigidBody(mass,shape);
          vec3.set(body.angularVelocity,0,10,0);
          body.angularDamping = 0.5;
          world.add(body);
          
      }
  
      function initThree() {
  
          scene = new THREE.Scene();
  
          camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100 );
          camera.position.z = 5;
          scene.add( camera );
  
          geometry = new THREE.CubeGeometry( 2, 2, 2 );
          material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );
  
          mesh = new THREE.Mesh( geometry, material );
          mesh.useQuaternion = true;
          scene.add( mesh );
  
          renderer = new THREE.CanvasRenderer();
          renderer.setSize( window.innerWidth, window.innerHeight );
  
          document.body.appendChild( renderer.domElement );
  
      }
  
      function animate() {
  
          requestAnimationFrame( animate );
          updatePhysics();
          render();
  
      }
  
      function updatePhysics() {
          
          // Step the physics world
          world.step(timeStep);

          // Copy coordinates from Cannon.js to Three.js
          mesh.position.x = body.position[0];
          mesh.position.y = body.position[1];
          mesh.position.z = body.position[2];
          mesh.quaternion.x = body.quaternion[0];
          mesh.quaternion.y = body.quaternion[1];
          mesh.quaternion.z = body.quaternion[2];
          mesh.quaternion.w = body.quaternion[3];

          // We could also use the more convenient calls below
          // vec3.copyToXYZObject( mesh.position , body.position )
          // quat.copyToXYZWObject( mesh.quaternion , body.quaternion )
  
      }
  
      function render() {
  
          renderer.render( scene, camera );
  
      }
  
    </script>
  </body>
</html>
